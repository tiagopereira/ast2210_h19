



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
        <link rel="canonical" href="https://tiagopereira.space/ast2210_h19/IRIS/">
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-4.6.3">
    
    
      
        <title>IRIS and AIA - AST2210 Solar Lab</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.adb8469c.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.86422ebf.js"></script>
    
    
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#iris-and-aia" tabindex="0" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://tiagopereira.space/ast2210_h19" title="AST2210 Solar Lab" aria-label="AST2210 Solar Lab" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              AST2210 Solar Lab
            </span>
            <span class="md-header-nav__topic">
              
                IRIS and AIA
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" aria-label="search" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/tiagopereira/ast2210_h19" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    tiagopereira/ast2210_h19
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://tiagopereira.space/ast2210_h19" title="AST2210 Solar Lab" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    AST2210 Solar Lab
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/tiagopereira/ast2210_h19" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    tiagopereira/ast2210_h19
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../prep/" title="Preparation" class="md-nav__link">
      Preparation
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../sunpy_aia/" title="Sunpy and AIA" class="md-nav__link">
      Sunpy and AIA
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        IRIS and AIA
      </label>
    
    <a href="./" title="IRIS and AIA" class="md-nav__link md-nav__link--active">
      IRIS and AIA
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#initialisation" class="md-nav__link">
    Initialisation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#working-with-iris-sji-files" class="md-nav__link">
    Working with IRIS SJI files
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-aia-for-context" class="md-nav__link">
    Using AIA for context
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#putting-everything-together" class="md-nav__link">
    Putting everything together
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#measuring-spatial-scales" class="md-nav__link">
    Measuring spatial scales
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../assignment/" title="Assignment" class="md-nav__link">
      Assignment
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#initialisation" class="md-nav__link">
    Initialisation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#working-with-iris-sji-files" class="md-nav__link">
    Working with IRIS SJI files
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-aia-for-context" class="md-nav__link">
    Using AIA for context
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#putting-everything-together" class="md-nav__link">
    Putting everything together
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#measuring-spatial-scales" class="md-nav__link">
    Measuring spatial scales
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <p><a href="../IRIS.ipynb">Download this page</a> as a Jupyter notebook.</p>
<h1 id="iris-and-aia">IRIS and AIA<a class="headerlink" href="#iris-and-aia" title="Permanent link">&para;</a></h1>
<p>To work with IRIS data in Python we will make use of the <a href="http://docs.sunpy.org/projects/irispy/en/latest/">IRISPy</a> package. IRISPy is an affiliated package of SunPy.</p>
<h2 id="initialisation">Initialisation<a class="headerlink" href="#initialisation" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><code><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">Polygon</span>

<span class="kn">import</span> <span class="nn">numpy</span>

<span class="kn">from</span> <span class="nn">irispy.sji</span> <span class="kn">import</span> <span class="n">read_iris_sji_level2_fits</span>

<span class="kn">import</span> <span class="nn">sunpy.map</span>
<span class="kn">from</span> <span class="nn">sunpy.instr.aia</span> <span class="kn">import</span> <span class="n">aiaprep</span>
<span class="kn">from</span> <span class="nn">sunpy.time</span> <span class="kn">import</span> <span class="n">parse_time</span>

<span class="kn">from</span> <span class="nn">astropy.coordinates</span> <span class="kn">import</span> <span class="n">SkyCoord</span>
<span class="kn">from</span> <span class="nn">astropy</span> <span class="kn">import</span> <span class="n">units</span> <span class="k">as</span> <span class="n">u</span>

<span class="c1"># To make a larger figure</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span>

<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
</code></pre></div>

<h2 id="working-with-iris-sji-files">Working with IRIS SJI files<a class="headerlink" href="#working-with-iris-sji-files" title="Permanent link">&para;</a></h2>
<p>Let us start by loading the IRIS dataset that was taken at a similar time to the AIA images we worked on earlier. IRIS has both a spectrograph and an imager, but here we'll work only with the imager (SJI = Slit-Jaw Image). These images show the position of the spectrograph slit with respect to the solar image. The slit is the central, vertical dark line in the images.  </p>
<p>To read IRIS SJI files, we'll make use of the <code class="codehilite"><span class="err">read_iris_sji_level2_fits</span></code> from <code class="codehilite"><span class="err">IRISPy</span></code>:</p>
<div class="codehilite"><pre><span></span><code><span class="n">sji</span> <span class="o">=</span> <span class="n">read_iris_sji_level2_fits</span><span class="p">(</span><span class="s2">&quot;iris_l2_20140919_051712_3860608353_SJI_2832_t000.fits&quot;</span><span class="p">)</span>
<span class="n">sji</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">INFO</span><span class="o">:</span> <span class="n">uncertainty</span> <span class="n">should</span> <span class="n">have</span> <span class="n">attribute</span> <span class="n">uncertainty_type</span><span class="o">.</span> <span class="o">[</span><span class="n">astropy</span><span class="o">.</span><span class="na">nddata</span><span class="o">.</span><span class="na">nddata</span><span class="o">]</span>






    <span class="n">IRISMapCube</span>
    <span class="o">---------</span>
    <span class="n">Observatory</span><span class="o">:</span>         <span class="n">IRIS</span>
    <span class="n">Instrument</span><span class="o">:</span>          <span class="n">SJI</span>
    <span class="n">Bandpass</span><span class="o">:</span>            <span class="mf">2832.0</span>
    <span class="n">Obs</span><span class="o">.</span> <span class="n">Start</span><span class="o">:</span>          <span class="mi">2014</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">19</span><span class="n">T05</span><span class="o">:</span><span class="mi">17</span><span class="o">:</span><span class="mf">12.610000</span>
    <span class="n">Obs</span><span class="o">.</span> <span class="n">End</span><span class="o">:</span>            <span class="mi">2014</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">19</span><span class="n">T07</span><span class="o">:</span><span class="mi">14</span><span class="o">:</span><span class="mf">54.895000</span>
    <span class="n">Instance</span> <span class="n">Start</span><span class="o">:</span>      <span class="mi">2014</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">19</span><span class="n">T05</span><span class="o">:</span><span class="mi">17</span><span class="o">:</span><span class="mf">31.110000</span>
    <span class="n">Instance</span> <span class="n">End</span><span class="o">:</span>        <span class="mi">2014</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">19</span><span class="n">T07</span><span class="o">:</span><span class="mi">13</span><span class="o">:</span><span class="mf">24.610000</span>
    <span class="n">Total</span> <span class="n">Frames</span> <span class="k">in</span> <span class="n">Obs</span><span class="o">.:</span>    <span class="mi">65</span>
    <span class="n">IRIS</span> <span class="n">Obs</span><span class="o">.</span> <span class="n">id</span><span class="o">:</span>        <span class="mi">3860608353</span>
    <span class="n">IRIS</span> <span class="n">Obs</span><span class="o">.</span> <span class="n">Description</span><span class="o">:</span>   <span class="n">Large</span> <span class="n">sit</span><span class="o">-</span><span class="n">and</span><span class="o">-</span><span class="n">stare</span> <span class="mf">0.3</span><span class="n">x120</span> <span class="mi">1</span><span class="n">s</span>  <span class="n">C</span> <span class="n">II</span>   <span class="n">Mg</span> <span class="n">II</span> <span class="n">h</span><span class="o">/</span><span class="n">k</span>   <span class="n">Mg</span> <span class="n">II</span> <span class="n">w</span> <span class="n">s</span> <span class="n">Deep</span> <span class="n">x</span>
    <span class="n">Cube</span> <span class="n">dimensions</span><span class="o">:</span>         <span class="o">[</span> <span class="mi">65</span><span class="o">.</span> <span class="mi">387</span><span class="o">.</span> <span class="mi">364</span><span class="o">.]</span> <span class="n">pix</span>
    <span class="n">Axis</span> <span class="n">Types</span><span class="o">:</span>          <span class="o">(</span><span class="n">None</span><span class="o">,</span> <span class="s1">&#39;custom:pos.helioprojective.lat&#39;</span><span class="o">,</span> <span class="s1">&#39;custom:pos.helioprojective.lon&#39;</span><span class="o">)</span>
</code></pre></div>


<p>This loads the data into an <code class="codehilite"><span class="err">IRISMapCube</span></code> object. Unlike AIA, an IRIS SJI file contains many images. In the summary above, we can see that this sequence on 2014-09-19 goes from 05:17:31 to 07:13:24 and contains 65 images. Each image has dimensions of (nx, ny) = (387, 364). Like <code class="codehilite"><span class="err">Map</span></code> in SunPy, <code class="codehilite"><span class="err">IRISMapCube</span></code> contains additional metadata, including the coordinates of the observation. It also has a <code class="codehilite"><span class="na">.plot</span><span class="p">()</span></code> method, that allows a quick plotting of images:</p>
<div class="codehilite"><pre><span></span><code><span class="n">sji</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<p><img alt="png" src="../IRIS_files/IRIS_6_0.png" /></p>
<p>Here, we are plotting the first image in the sequence. It is also possible to simply call <code class="codehilite"><span class="err">sji.plot()</span></code>, which will return an animator instance that can play a movie of all images when an interactive matplotlib backend is used (here we are using <code class="codehilite"><span class="err">inline</span></code>, which works better in the browser, but is not interactive).</p>
<p>The plot does not look as complete as <code class="codehilite"><span class="err">sunpy.map.Map.plot()</span></code> because IRISPy is still a very new package and does not have all the features in SunPy. In the above we can see that the time of the observation is not shown, and the coordinate axes are not labelled and they appear in degrees/minutes/arcseconds instead of just arcseconds. We can manually create a more complete plot: </p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Use WCS coordinates, but drop last axis (time)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">sji</span><span class="o">.</span><span class="n">wcs</span><span class="o">.</span><span class="n">dropaxis</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">sji</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;irissji2832&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="s1">&#39;s.s&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="s1">&#39;s.s&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Helioprojective Longitude (Solar-X) [arcsec]&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Helioprojective Latitude (Solar-Y) [arcsec]&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;IRIS SJI </span><span class="si">%.0f</span><span class="s2">Å </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sji</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;TWAVE1&#39;</span><span class="p">],</span>
                                    <span class="n">sji</span><span class="o">.</span><span class="n">extra_coords</span><span class="p">[</span><span class="s1">&#39;TIME&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<p><img alt="png" src="../IRIS_files/IRIS_8_0.png" /></p>
<p>Now we have a plot that is much closer to that of SunPy map. </p>
<div class="admonition info">
<p class="admonition-title">What is different between IRIS and AIA images?</p>
<p>The image above is different from the AIA images in many ways:</p>
<ul>
<li>We have only a small field-of-view and not the whole disk, but higher spatial resolution</li>
<li>There is a vertical black line (the IRIS slit)</li>
<li>The coordinate axes and grid are not always aligned with the 
  image axes because IRIS can be rotated (rolled) for observations. 
  In this case the roll is about 45º</li>
<li>There is a white border around the image with a slight tilt.
  These are CCD pixels that are not exposed to solar light, and in some 
  cases can also be padding for the full size of a raster.</li>
</ul>
</div>
<h2 id="using-aia-for-context">Using AIA for context<a class="headerlink" href="#using-aia-for-context" title="Permanent link">&para;</a></h2>
<p>We can use IRIS to zoom in on the small details, and AIA to get a global view. Let us look at an AIA image and see the region surrounding the IRIS field-of-view. We will use the first AIA 1700Å image we downloaded earlier in the AIA exercises, with a file name of <code class="codehilite"><span class="err">aia_20140919_060030_1700_image_lev1.fits</span></code>, that should be in <code class="codehilite"><span class="err">~/sunpy/data</span></code> (if you don't have it, please run the SunPy exercise again). Please adjust the following to make sure it reflects the path in your computer:</p>
<div class="codehilite"><pre><span></span><code><span class="n">aia_file</span> <span class="o">=</span> <span class="s1">&#39;/Users/tiago/sunpy/data/aia_20140919_060030_1700_image_lev1.fits&#39;</span>
<span class="n">tmp</span> <span class="o">=</span> <span class="n">sunpy</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">Map</span><span class="p">(</span><span class="n">aia_file</span><span class="p">)</span>
<span class="n">aia</span> <span class="o">=</span> <span class="n">aiaprep</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>

<span class="c1"># create a submap around the sunspots</span>
<span class="n">top_right</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="o">-</span><span class="mi">550</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">arcsec</span><span class="p">,</span> <span class="mi">180</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">arcsec</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="n">aia</span><span class="o">.</span><span class="n">coordinate_frame</span><span class="p">)</span>
<span class="n">bottom_left</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="o">-</span><span class="mi">900</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">arcsec</span><span class="p">,</span> <span class="o">-</span><span class="mf">80.</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">arcsec</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="n">aia</span><span class="o">.</span><span class="n">coordinate_frame</span><span class="p">)</span>
<span class="n">aia_sub</span> <span class="o">=</span> <span class="n">aia</span><span class="o">.</span><span class="n">submap</span><span class="p">(</span><span class="n">top_right</span><span class="p">,</span> <span class="n">bottom_left</span><span class="p">)</span>
<span class="n">aia_sub</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<p><img alt="png" src="../IRIS_files/IRIS_10_0.png" /></p>
<p>This is what we saw earlier. Now let's plot the IRIS field of view on the AIA image using the information from the WCS coordinates. We will use the method <code class="codehilite"><span class="err">pixel_to_world</span></code> to convert from pixels to WCS coordinates, and then plot a polygon using the coordinates of the 4 corners of the IRIS image:</p>
<div class="codehilite"><pre><span></span><code><span class="n">aia_sub</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">dims</span> <span class="o">=</span> <span class="n">sji</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span>
<span class="n">_</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">xpts</span> <span class="o">=</span> <span class="n">sji</span><span class="o">.</span><span class="n">pixel_to_world</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">pix</span><span class="p">,</span> 
                                   <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span><span class="mi">1</span> <span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">pix</span><span class="p">,</span>
                                   <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dims</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dims</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">pix</span><span class="p">)</span>
<span class="n">iris_points</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">xpts</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">ypts</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="p">])</span><span class="o">.</span><span class="n">T</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">iris_points</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">get_transform</span><span class="p">(</span><span class="s1">&#39;world&#39;</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<p><img alt="png" src="../IRIS_files/IRIS_12_0.png" /></p>
<p>So now we have the blue square showing the region of the IRIS observations. If we compare with the IRIS image above, this seems right: we capture both sunspots, and one of them is close to the edge. To work with both IRIS and AIA data, it helps if the image axes are aligned, and for this we need to rotate one of them. We can either rotate AIA to the IRIS frame, or vice-versa. Generally, it is easier to rotate AIA to IRIS because IRIS images are higher resolution and the files contain a sequence of images. Let's do that, again using the WCS coordinates of both objects. First, we rotate the AIA map using the inverse rotation of the IRIS frame:</p>
<div class="codehilite"><pre><span></span><code><span class="n">aia_rot</span> <span class="o">=</span> <span class="n">aia</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">rmatrix</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">sji</span><span class="o">.</span><span class="n">wcs</span><span class="o">.</span><span class="n">wcs</span><span class="o">.</span><span class="n">pc</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">I</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># Create submap on rotated image, with slightly smaller lower field of view</span>
<span class="n">top_right</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="o">-</span><span class="mi">610</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">arcsec</span><span class="p">,</span> <span class="mi">160</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">arcsec</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="n">aia_rot</span><span class="o">.</span><span class="n">coordinate_frame</span><span class="p">)</span>
<span class="n">bottom_left</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="o">-</span><span class="mi">880</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">arcsec</span><span class="p">,</span> <span class="o">-</span><span class="mf">40.</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">arcsec</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="n">aia_rot</span><span class="o">.</span><span class="n">coordinate_frame</span><span class="p">)</span>
<span class="n">aia_rot_sub</span> <span class="o">=</span> <span class="n">aia_rot</span><span class="o">.</span><span class="n">submap</span><span class="p">(</span><span class="n">top_right</span><span class="p">,</span> <span class="n">bottom_left</span><span class="p">)</span>
<span class="n">aia_rot_sub</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="c1"># add the same IRIS field-of-view:</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">iris_points</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">get_transform</span><span class="p">(</span><span class="s1">&#39;world&#39;</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<p><img alt="png" src="../IRIS_files/IRIS_15_0.png" /></p>
<p>We can now see that the IRIS field-of-view appears as a straight square, because we rotated the view so the image axes of AIA and IRIS coincide. Here we show a submap of AIA to see a larger region around the IRIS observations.</p>
<details class="question"><summary>Can you make an AIA submap be the same field-of-view as IRIS?</summary><p>Above, we define two coordinates, <code class="codehilite"><span class="err">top_right</span></code> and <code class="codehilite"><span class="err">bottom_left</span></code> (from <code class="codehilite"><span class="err">Skycoord</span></code>, in arcsec). So to make an AIA submap be exactly the same field-of-view as IRIS, we just need to change <code class="codehilite"><span class="err">top_right</span></code> and <code class="codehilite"><span class="err">bottom_left</span></code> to be the limits of the IRIS image. We already have these IRIS coordinates when we plot the blue square, so we just need to find which ones are the bottom left and top right corners and put them on a <code class="codehilite"><span class="err">SkyCoord</span></code> object. In this case, it is: </p>
<div class="codehilite"><pre><span></span><code><span class="n">top_right</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="n">xpts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">frame</span><span class="o">=</span><span class="n">aia_rot</span><span class="o">.</span><span class="n">coordinate_frame</span><span class="p">)</span>
<span class="n">bottom_left</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="n">xpts</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">frame</span><span class="o">=</span><span class="n">aia_rot</span><span class="o">.</span><span class="n">coordinate_frame</span><span class="p">)</span>
</code></pre></div>

</details>
<h2 id="putting-everything-together">Putting everything together<a class="headerlink" href="#putting-everything-together" title="Permanent link">&para;</a></h2>
<p>We have seen how to load an IRIS image, and how to plot its field-of-view on top of an AIA image. Now we are going to directly compare IRIS with AIA.</p>
<p>First, we need to make sure we compare images taken at similar times, because the solar atmosphere evolves quickly. The AIA image above was taken on 2014-09-19 06:00:30. How do we find the IRIS image closest in time?</p>
<p>The observing time for each IRIS image is saved under <code class="codehilite"><span class="err">sji.extra_coords[&#39;TIME&#39;]</span></code>.</p>
<p>Let us start by finding out the time of this observation. The time each frame was acquired is saved under <code class="codehilite"><span class="err">sji.extra_coords[&#39;TIME&#39;]</span></code>, and the AIA observing time is saved in <code class="codehilite"><span class="na">.meta</span><span class="p">[</span><span class="err">&#39;</span><span class="no">date-obs</span><span class="err">&#39;</span><span class="p">]</span></code>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># convert AIA time from string to datetime</span>
<span class="n">aia_time</span> <span class="o">=</span> <span class="n">parse_time</span><span class="p">(</span><span class="n">aia_rot_sub</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;date-obs&#39;</span><span class="p">])</span>
<span class="n">iris_times</span> <span class="o">=</span> <span class="n">sji</span><span class="o">.</span><span class="n">extra_coords</span><span class="p">[</span><span class="s1">&#39;TIME&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
<span class="c1"># Now get the difference between AIA and IRIS times</span>
<span class="n">time_diff</span> <span class="o">=</span> <span class="n">aia_time</span> <span class="o">-</span> <span class="n">iris_times</span>
<span class="c1"># and the index with the lowest difference</span>
<span class="n">time_index</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">time_diff</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;AIA time:  </span><span class="si">%s</span><span class="se">\n</span><span class="s2">IRIS time: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">aia_time</span><span class="p">,</span> <span class="n">iris_times</span><span class="p">[</span><span class="n">time_index</span><span class="p">]))</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="err">AIA time:  2014-09-19 06:00:30.711610</span>
<span class="err">IRIS time: 2014-09-19 06:00:58.670000</span>
</code></pre></div>


<p>We see that the closest IRIS time is about 28 seconds after the AIA observation, which is ok. We can now plot the IRIS and AIA side by side:</p>
<div class="codehilite"><pre><span></span><code><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">aia_rot_sub</span><span class="p">)</span>
<span class="n">aia_rot_sub</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">iris_points</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">transform</span><span class="o">=</span><span class="n">ax1</span><span class="o">.</span><span class="n">get_transform</span><span class="p">(</span><span class="s1">&#39;world&#39;</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> 

<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">sji</span><span class="o">.</span><span class="n">wcs</span><span class="o">.</span><span class="n">dropaxis</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">sji</span><span class="p">[</span><span class="n">time_index</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;irissji2832&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="s1">&#39;s.s&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="s1">&#39;s.s&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Helioprojective Longitude (Solar-X) [arcsec]&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Helioprojective Latitude (Solar-Y) [arcsec]&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;IRIS SJI </span><span class="si">%.0f</span><span class="s2">Å </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sji</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;TWAVE1&#39;</span><span class="p">],</span>
                                    <span class="n">sji</span><span class="o">.</span><span class="n">extra_coords</span><span class="p">[</span><span class="s1">&#39;TIME&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<p><img alt="png" src="../IRIS_files/IRIS_21_0.png" /></p>
<h2 id="measuring-spatial-scales">Measuring spatial scales<a class="headerlink" href="#measuring-spatial-scales" title="Permanent link">&para;</a></h2>
<p>When analysing images, we often want to measure spatial scales in e.g. km. How do we convert from image pixels to km? And how to we measure image pixels? We have seen above that to convert from pixels to WCS coordinates we can make use of <code class="codehilite"><span class="na">.pixel_to_world</span></code>. For SunPy <code class="codehilite"><span class="err">Map</span></code> objects such as our AIA image, the output is a <code class="codehilite"><span class="err">SkyCoord</span></code> (we have only two dimensions):</p>
<div class="codehilite"><pre><span></span><code><span class="n">c</span> <span class="o">=</span> <span class="n">aia_rot_sub</span><span class="o">.</span><span class="n">pixel_to_world</span><span class="p">(</span><span class="mi">0</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">pix</span><span class="p">,</span> <span class="mi">0</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">pix</span><span class="p">)</span>
<span class="n">c</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="err">&lt;SkyCoord (Helioprojective: obstime=2014-09-19 06:00:30.711610, rsun=696000000.0 m, observer=&lt;HeliographicStonyhurst Coordinate (obstime=2014-09-19 06:00:30.711610): (lon, lat, radius) in (deg, deg, m)</span>
<span class="err">    (0., 7.1342492, 1.50333097e+11)&gt;): (Tx, Ty) in arcsec</span>
<span class="err">    (-979.39734017, 62.42308006)&gt;</span>
</code></pre></div>


<p>The solar X and Y coordinates in arcsec can be accessed by:</p>
<div class="codehilite"><pre><span></span><code><span class="n">c</span><span class="o">.</span><span class="n">Tx</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Ty</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="err">(&lt;Longitude -979.39734017 arcsec&gt;, &lt;Latitude 62.42308006 arcsec&gt;)</span>
</code></pre></div>


<p>For <code class="codehilite"><span class="err">IRISMapCube</span></code> objects, the data have 3 dimensions (time being the first), and we must specify all:</p>
<div class="codehilite"><pre><span></span><code><span class="n">sji</span><span class="o">.</span><span class="n">pixel_to_world</span><span class="p">(</span><span class="mi">0</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">pix</span><span class="p">,</span> <span class="mi">0</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">pix</span><span class="p">,</span> <span class="mi">0</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">pix</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="err">[&lt;Quantity 2506.4372 s&gt;, &lt;Quantity 0.01548156 deg&gt;, &lt;Quantity -0.23177934 deg&gt;]</span>
</code></pre></div>


<p>The output is in different <code class="codehilite"><span class="err">Quantity</span></code> objects, the first being the time since the start of the IRIS observation, followed by solar X and Y in degrees. </p>
<p>Now let us assume that in the IRIS image, we want to calculate the distance between the sunspots. With coordinates, we can  overplot lines on top of the images (as we did previously with the IRIS field of view on AIA). Let us plot the IRIS image and plot the approximate coordinates between the centres of the sunspot (these were obtained by experimenting):</p>
<div class="codehilite"><pre><span></span><code><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">sji</span><span class="o">.</span><span class="n">wcs</span><span class="o">.</span><span class="n">dropaxis</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">sji</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;irissji2832&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="s1">&#39;s.s&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="s1">&#39;s.s&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>

<span class="c1"># approximate (x, y) coordinates of sunspots in arcsec</span>
<span class="n">sunspot1</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">720</span><span class="p">,</span> <span class="mi">97</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">arcsec</span>   
<span class="n">sunspot2</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">716</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">arcsec</span>

<span class="c1"># Must convert from arcsec to degrees because WCSAxes works always in degrees</span>
<span class="n">sunspot_x</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">([</span><span class="n">sunspot1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sunspot2</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span>
<span class="n">sunspot_y</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">([</span><span class="n">sunspot1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sunspot2</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span>

<span class="c1"># use get_transform(&#39;world&#39;) to plot in coordinate space</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sunspots_x</span><span class="p">,</span> <span class="n">sunspots_y</span><span class="p">,</span> <span class="s1">&#39;bo-&#39;</span><span class="p">,</span>
        <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">get_transform</span><span class="p">(</span><span class="s1">&#39;world&#39;</span><span class="p">),</span>  <span class="n">ms</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<p><img alt="png" src="../IRIS_files/IRIS_29_0.png" /></p>
<p>Now that we have the coordinates, the distance between the sunspots is simply the euclidian distance:</p>
<div>
<div class="MathJax_Preview">
d = \sqrt{(x_1 - x_2)^2 + (y_1 - y_2)^2}
</div>
<script type="math/tex; mode=display">
d = \sqrt{(x_1 - x_2)^2 + (y_1 - y_2)^2}
</script>
</div>
<p>We can use <code class="codehilite"><span class="err">numpy.linalg.norm</span></code> to avoid having to type all those points by hand, and we get the distance in arcsec:</p>
<div class="codehilite"><pre><span></span><code><span class="n">dist</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">sunspot1</span> <span class="o">-</span> <span class="n">sunspot2</span><span class="p">)</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">arcsec</span>
<span class="n">dist</span>
</code></pre></div>

<p><span><span class="MathJax_Preview">86.092973 \; \mathrm{{}^{\prime\prime}}</span><script type="math/tex">86.092973 \; \mathrm{{}^{\prime\prime}}</script></span></p>
<p>In any case, a question remains: how to convert from coordinates (deg, arcsec) to distance in km?</p>
<div class="admonition info">
<p class="admonition-title">Angular vs linear distance</p>
<p>So far we are working with angular distances and not linear distances.
When the angular size of an object is very small (less than 1º, as most astronomical objects), we can use
the small angle approximation and relate the angular to linear distance: <span><span class="MathJax_Preview">d = \alpha D</span><script type="math/tex">d = \alpha D</script></span>, where
<span><span class="MathJax_Preview">\alpha</span><script type="math/tex">\alpha</script></span> is the angular distance (in radians) and <span><span class="MathJax_Preview">D</span><script type="math/tex">D</script></span> is the distance to the object (in our case, the Sun).</p>
</div>
<details class="question"><summary>When is Earth closer to the Sun?</summary><p>The distance between Earth and the Sun varies with time, because Earth's orbit is not perfectly circular. 
The point when Earth is closest to the Sun is called <em>periapsis</em> and takes place approximately on January 3.
The point when Earth is farthest from the Sun is called <em>apoapsis</em> and takes place approximately on July 3.</p>
</details>
<p>The distance between the Sun and Earth is 1 au, or 149.597 Gm, but this is the mean distance between perihelion and aphelion. The exact distance will depend on the time of our observations. Fortunately, SunPy has utility functions that we can use to calculate this:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">sunpy.coordinates</span> <span class="kn">import</span> <span class="n">frames</span>

<span class="c1"># time of first IRIS image</span>
<span class="n">obs_date</span> <span class="o">=</span> <span class="n">sji</span><span class="o">.</span><span class="n">extra_coords</span><span class="p">[</span><span class="s1">&#39;TIME&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># get 1&quot; interval at disk-centre between in cartesian coordinates </span>
<span class="n">a1</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="mi">0</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">arcsec</span><span class="p">,</span> <span class="mi">0</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">arcsec</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s1">&#39;helioprojective&#39;</span><span class="p">,</span>
              <span class="n">obstime</span><span class="o">=</span><span class="n">obs_date</span><span class="p">)</span><span class="o">.</span><span class="n">transform_to</span><span class="p">(</span><span class="s1">&#39;heliocentric&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">x</span>
<span class="n">a2</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="mi">1</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">arcsec</span><span class="p">,</span> <span class="mi">0</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">arcsec</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s1">&#39;helioprojective&#39;</span><span class="p">,</span>
              <span class="n">obstime</span><span class="o">=</span><span class="n">obs_date</span><span class="p">)</span><span class="o">.</span><span class="n">transform_to</span><span class="p">(</span><span class="s1">&#39;heliocentric&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">x</span>
<span class="n">asec_to_Mm</span> <span class="o">=</span> <span class="p">(</span><span class="n">a2</span> <span class="o">-</span> <span class="n">a1</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">Mm</span><span class="p">)</span>
<span class="n">asec_to_Mm</span>
</code></pre></div>

<p><span><span class="MathJax_Preview">0.72526922 \; \mathrm{Mm}</span><script type="math/tex">0.72526922 \; \mathrm{Mm}</script></span></p>
<p>So we see that in this date, 1<span><span class="MathJax_Preview">{}^{\prime\prime}</span><script type="math/tex">{}^{\prime\prime}</script></span> is about 725.26922 km. We can use this to convert the distance between the sunspots and get the final result in Mm:</p>
<div class="codehilite"><pre><span></span><code><span class="n">dist_Mm</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">asec_to_Mm</span>
<span class="n">dist_Mm</span>
</code></pre></div>

<p><span><span class="MathJax_Preview">62.440583 \; \mathrm{Mm}</span><script type="math/tex">62.440583 \; \mathrm{Mm}</script></span></p>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../sunpy_aia/" title="Sunpy and AIA" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Sunpy and AIA
              </span>
            </div>
          </a>
        
        
          <a href="../assignment/" title="Assignment" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Assignment
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org" target="_blank" rel="noopener">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/tiagopereira" target="_blank" rel="noopener" title="github-alt" class="md-footer-social__link fa fa-github-alt"></a>
    
      <a href="https://tiagopereira.space/" target="_blank" rel="noopener" title="globe" class="md-footer-social__link fa fa-globe"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.c33a9706.js"></script>
      
      <script>app.initialize({version:"1.1",url:{base:".."}})</script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>